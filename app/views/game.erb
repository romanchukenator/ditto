<% @current_round = Round.where(game_id: @game.id).last%>

<div class="continer-fluid">

<div class="row">
  <div class="col-xs-12 text-center">
    <h1>Ditto</h1>
    <h3>Game ID: <%= @game.id %> </h2>
    <h4>User: <%= current_user.email %></h2>
  </div>
</div>

<!--  -->
<!-- This malarky is to first check if a round exists, if not create one and populate the player1_word column -->
<!--  -->

<% if !Round.round_exists?(@game) && @game.player1?(current_user) %>
  <div class="row">
    
    <div class="col-xs-12 text-center">
    <h2>FIRST TURN</h2>

      <form
      action="/game/<%= @game.id %>/create-round" 
      method="POST"
      class="form-inline" 
      role="form">
    </div>

    <div class="col-xs-12 text-center">
      <input 
          type="text"
          class="form-control text-center" 
          placeholder="WHAT'S THE COMMONALITY?"
          NAME="first_word">
    </div>

    <div class="col-xs-12 text-center">
      <button 
        type="submit" 
        name="Submit"
        class="btn btn-default">
            MAKE IT GOOD
      </button>
    </div>

    </form>

  </div>
<% end %>

<!--  -->
<!-- Displays previous guesses -->
<!--  -->

<% x = 1 %>
<% Round.where(game_id: @game.id).each do |round| %>

  <% break if round.player1_word == round.player2_word %>

  <% if (round.player1_word && round.player2_word) %>

      <div class="col-xs-5 text-center alert alert-success">    
        <% if @game.player1?(current_user) %>
          <%= @p1_word = round.player1_word %>
        <% else %>
          <%= @p2_word = round.player2_word %>
        <% end %>
      </div>

      <div class="col-xs-2 text-center">
        <p>ROUND<br /> <%= x %></p>
      </div>


      <div class="col-xs-5 text-center alert alert-success">
        <% if !@game.player1?(current_user) %>
          <%= @p1_word = round.player1_word %>
        <% else %>
          <%= @p2_word = round.player2_word %>
        <% end %>
      </div>

    <% end %>
  
<% x += 1 %>
<% end %>

<!--  -->
<!-- This is all the stuff regarding the way to pick players and who should go when -->
<!--  -->

<% if Round.round_exists?(@game) %>
  <h3 class="text-center">Current Round: <%= Round.round_count(@game) %></h2>
<% if !@current_round.word_match? %>

  <% if (@current_round.player1_word == nil) && @game.player1?(current_user)%>
    <div class="row">
      
      <div class="col-xs-12 text-center">

        <form
        action="/game/<%= @game.id %>/guess/<%= @current_round.id %>"
        method="POST"
        class="form-inline" 
        role="form">
      </div>

      <div class="col-xs-12 text-center">
        <input  
            type="text"
            class="form-control text-center" 
            placeholder="WHAT'S THE COMMONALITY, PLAYER1?"
            NAME="player1_word">
      </div>

      <div class="col-xs-12 text-center">
        <button 
          type="submit" 
          name="Submit"
          class="btn btn-default">
              MAKE IT GOOD PLAYER 1
        </button>
      </div>
      </form>

    </div>
  <% end %>

  <% if (@current_round.player2_word == nil) && !@game.player1?(current_user)%>

    <div class="row">
      
      <div class="col-xs-12 text-center">

        <form
        action="/game/<%= @game.id %>/guess/<%= @current_round.id %>"
        method="POST"
        class="form-inline" 
        role="form">
      </div>

      <div class="col-xs-12 text-center">
        <input 
            type="text"
            class="form-control text-center" 
            placeholder="WHAT'S THE COMMONALITY, PLAYER 2?"
            NAME="player2_word">
      </div>

      <div class="col-xs-12 text-center">
        <button 
          type="submit" 
          name="Submit"
          class="btn btn-default">
              MAKE IT GOOD PLAYER 2
        </button>
      </div>

      </form>
    </div>

  <% end %>

<% end %>


<!-- Waiting on other players display -->

<% unless @current_round.word_match? %>
  <% if @current_round.player1_word && @game.player1?(current_user)%>
    <h3>waiting on other player</h3>
  <% end %>

  <% if @current_round.player2_word && !@game.player1?(current_user)%>
    <h3>waiting on other player</h3>
  <% end %>
<% end %>
  
<!-- Same word display! -->

<% if @current_round.word_match? %>  
  <div class="row">
    <div class="col-xs-3">
    </div>

    <div class="col-xs-6 text-center">
      <h1>Both said: <%= @current_round.player2_word %></h1>
    </div>

    <div class="col-xs-3">
    </div>
  </div>
  <% @game.update(status: "Complete") %>  
<% end %>

<p id="the-good-stuff"></p>

<% end %>

<a href="/profile">Back to profile</a>

</div>
</div>


